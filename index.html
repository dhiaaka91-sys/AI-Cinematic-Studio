<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Cinematic Studio | Real AI Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&family=Inter:wght@400;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
    <style>
        :root { --glass: rgba(10, 10, 15, 0.9); --cyan: #06b6d4; --fuchsia: #d946ef; }
        body { background: #050508; color: #e2e8f0; font-family: 'Inter', 'Tajawal', sans-serif; overflow: hidden; margin: 0; }
        .glass-panel { background: var(--glass); backdrop-filter: blur(30px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 15px 45px rgba(0,0,0,0.8); }
        .input-glass { background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); color: white; transition: all 0.3s; }
        .input-glass:focus { border-color: var(--cyan); box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); outline: none; }
        .text-glow { text-shadow: 0 0 15px rgba(6, 182, 212, 0.6); }
        @keyframes scan { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        .scan-line { position: absolute; inset: 0; background: linear-gradient(to bottom, transparent, var(--cyan), transparent); height: 2px; animation: scan 2s linear infinite; opacity: 0.3; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        @media print { .no-print { display: none !important; } .print-only { display: block !important; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "lucide-react": "https://esm.sh/lucide-react@0.244.0"
      }
    }
    </script>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom';
        import * as Lucide from 'lucide-react';

        // === المشهد صفر: فيزياء الكلاكيت ===
        const SceneZero = ({ onComplete }) => {
            const sceneRef = useRef(null);
            useEffect(() => {
                const engine = Matter.Engine.create();
                const render = Matter.Render.create({
                    element: sceneRef.current,
                    engine: engine,
                    options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: 'transparent' }
                });
                const ground = Matter.Bodies.rectangle(window.innerWidth/2, window.innerHeight + 50, window.innerWidth, 100, { isStatic: true });
                const clapper = Matter.Bodies.rectangle(window.innerWidth/2, -200, 240, 180, { 
                    restitution: 0.5, 
                    render: { sprite: { texture: 'https://cdn-icons-png.flaticon.com/512/3507/3507115.png', xScale: 0.4, yScale: 0.4 } } 
                });
                Matter.Composite.add(engine.world, [clapper, ground]);
                Matter.Runner.run(Matter.Runner.create(), engine);
                Matter.Render.run(render);
                setTimeout(() => { try { new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3').play(); } catch(e){} }, 700);
                setTimeout(onComplete, 2800);
                return () => { Matter.Render.stop(render); Matter.Engine.clear(engine); render.canvas.remove(); };
            }, []);
            return <div ref={sceneRef} className="fixed inset-0 z-[9999] pointer-events-none" />;
        };

        const App = () => {
            const [init, setInit] = useState(false);
            const [lang, setLang] = useState('ar');
            const [isGenerating, setIsGenerating] = useState(false);
            const [sceneDesc, setSceneDesc] = useState('');
            const [mood, setMood] = useState('cyber');
            const [history, setHistory] = useState([]);
            const [characters, setCharacters] = useState([
                { id: 1, name: "البطل", dna: "عين ميكانيكية متوهجة، معطف جلدي أسود طويل", isLocked: true }
            ]);

            const t = (k) => {
                const dict = {
                    en: { action: "Action!", scene: "Scene Vision", cast: "Locked DNA", mood: "Atmosphere", storyboard: "Storyboard" },
                    ar: { action: "إبدأ التصوير!", scene: "رؤية المشهد", cast: "البصمة الوراثية", mood: "الأجواء", storyboard: "لوحة المشاهد" }
                };
                return dict[lang][k] || k;
            };

            const handleAction = async () => {
                if (!sceneDesc) return;
                setIsGenerating(true);
                
                // بناء الطلب الذكي (الدمج بين الشخصية والجو العام)
                const dna = characters.filter(c => c.isLocked).map(c => `${c.name} with ${c.dna}`).join(". ");
                const moods = {
                    cyber: "cyberpunk style, neon cyan and fuchsia lighting, volumetric fog, rainy streets, 8k cinematic",
                    noir: "classic film noir style, dramatic shadows, black and white, grainy 35mm film, smoky atmosphere",
                    epic: "grand scale, epic fantasy, golden hour lighting, cinematic masterpiece, wide anamorphic lens"
                };

                const fullPrompt = encodeURIComponent(`Cinematic film shot of ${sceneDesc}. Featuring ${dna}. Style: ${moods[mood]}. highly detailed, masterpiece, movie frame.`);
                const seed = Math.floor(Math.random() * 999999);
                const imageUrl = `https://image.pollinations.ai/prompt/${fullPrompt}?width=1280&height=720&nologo=true&seed=${seed}`;

                const img = new Image();
                img.src = imageUrl;
                img.onload = () => {
                    setHistory([{ url: imageUrl, prompt: sceneDesc, mood: mood }, ...history]);
                    setIsGenerating(false);
                };
            };

            if (!init) return (
                <div className="fixed inset-0 bg-[#050508] flex flex-col items-center justify-center">
                    <div className="text-center animate-pulse">
                        <h2 className="text-[10px] font-mono tracking-[0.8em] text-cyan-500 uppercase mb-4 opacity-50">Studio Initializing...</h2>
                    </div>
                    <SceneZero onComplete={() => setInit(true)} />
                </div>
            );

            return (
                <div className="min-h-screen flex flex-col" dir={lang === 'ar' ? 'rtl' : 'ltr'}>
                    {/* الهيدر */}
                    <header className="glass-panel h-16 px-8 flex items-center justify-between z-50 no-print">
                        <div className="flex items-center gap-3">
                            <Lucide.Clapperboard className="text-cyan-500" size={20} />
                            <h1 className="font-bold tracking-tighter text-glow text-sm uppercase">AI Cinematic Studio</h1>
                        </div>
                        <div className="flex bg-white/5 rounded-full p-1 border border-white/10">
                            {['cyber', 'noir', 'epic'].map(m => (
                                <button key={m} onClick={() => setMood(m)} className={`px-5 py-1 rounded-full text-[9px] font-bold uppercase transition-all ${mood === m ? 'bg-cyan-600 text-white' : 'text-slate-500 hover:text-white'}`}>
                                    {m}
                                </button>
                            ))}
                        </div>
                        <button onClick={() => setLang(l => l === 'en' ? 'ar' : 'en')} className="text-[10px] font-bold border border-white/10 w-10 h-10 rounded-full flex items-center justify-center">
                            {lang === 'en' ? 'AR' : 'EN'}
                        </button>
                    </header>

                    {/* منطقة العمل */}
                    <main className="flex-1 grid grid-cols-1 lg:grid-cols-12 gap-8 p-8 overflow-hidden no-print">
                        {/* الجانب الأيسر: التحكم */}
                        <div className="lg:col-span-4 space-y-6 overflow-y-auto custom-scrollbar pr-2">
                            <div className="glass-panel p-6 rounded-[2.5rem] space-y-6 border-white/10">
                                <div className="space-y-2">
                                    <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest px-2">{t('scene')}</label>
                                    <textarea 
                                        className="w-full h-40 input-glass rounded-[1.5rem] p-5 text-sm resize-none leading-relaxed"
                                        placeholder={lang === 'en' ? "Describe your cinematic vision..." : "صف رؤيتك السينمائية هنا..."}
                                        value={sceneDesc}
                                        onChange={e => setSceneDesc(e.target.value)}
                                    />
                                </div>
                                <button 
                                    onClick={handleAction} disabled={isGenerating}
                                    className="w-full py-5 bg-gradient-to-r from-cyan-600 to-blue-700 rounded-[1.5rem] font-black uppercase tracking-[0.4em] text-[10px] hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-3 shadow-xl shadow-cyan-900/20"
                                >
                                    {isGenerating ? <Lucide.RefreshCw className="animate-spin" size={18} /> : <><Lucide.Play size={18} /> {t('action')}</>}
                                </button>
                            </div>

                            {/* البصمة الوراثية */}
                            <div className="glass-panel p-6 rounded-[2.5rem] border-white/10">
                                <h3 className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2">
                                    <Lucide.Fingerprint size={16} className="text-fuchsia-500" /> {t('cast')}
                                </h3>
                                {characters.map(c => (
                                    <div key={c.id} className="bg-black/40 border border-white/5 p-5 rounded-[1.5rem] relative group">
                                        <div className="flex justify-between items-center mb-1">
                                            <p className="text-xs font-bold text-white tracking-tight">{c.name}</p>
                                            <Lucide.ShieldCheck size={14} className="text-cyan-500" />
                                        </div>
                                        <p className="text-[10px] text-slate-500 italic leading-relaxed">{c.dna}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* الجانب الأيمن: العرض */}
                        <div className="lg:col-span-8 relative">
                            <div className="glass-panel rounded-[3.5rem] bg-black h-full overflow-hidden border border-white/10 relative shadow-2xl">
                                {history[0] ? (
                                    <img src={history[0].url} className="w-full h-full object-cover animate-fadeIn" alt="AI Generated Frame" />
                                ) : (
                                    <div className="h-full flex flex-col items-center justify-center space-y-4 opacity-20">
                                        <Lucide.Camera size={64} strokeWidth={1} />
                                        <p className="text-[10px] uppercase tracking-[0.6em]">Ready for Production</p>
                                    </div>
                                )}
                                {isGenerating && (
                                    <div className="absolute inset-0 bg-black/60 backdrop-blur-xl flex flex-col items-center justify-center space-y-6">
                                        <div className="scan-line"></div>
                                        <div className="relative">
                                            <div className="w-20 h-20 border-2 border-cyan-500/20 rounded-full animate-ping"></div>
                                            <Lucide.RefreshCw className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 animate-spin text-cyan-500" size={32} />
                                        </div>
                                        <p className="text-[10px] font-mono text-cyan-500 tracking-[0.5em] animate-pulse uppercase">Exposing Cinematic Frame...</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>

                    {/* نسخة الطباعة (Pitch Deck) */}
                    <div className="print-only hidden p-20 text-black bg-white min-h-screen">
                        <div className="border-b-8 border-black pb-6 mb-12">
                            <h1 className="text-6xl font-black uppercase tracking-tighter">Production Pitch Deck</h1>
                            <p className="text-xl font-mono mt-2 text-gray-500 uppercase tracking-widest">AI Generated Sequence // Confidential</p>
                        </div>
                        {history.map((h, i) => (
                            <div key={i} className="flex gap-12 mb-24 break-inside-avoid items-start">
                                <div className="w-2/3 border-4 border-black shadow-[15px_15px_0_0_rgba(0,0,0,0.1)]">
                                    <img src={h.url} className="w-full aspect-video object-cover" />
                                </div>
                                <div className="w-1/3 space-y-4">
                                    <h2 className="text-4xl font-black uppercase">Shot {history.length - i}</h2>
                                    <div className="h-1 w-20 bg-black"></div>
                                    <p className="text-2xl font-serif italic text-gray-800 leading-snug">"{h.prompt}"</p>
                                    <p className="text-sm font-bold text-cyan-600 uppercase tracking-widest">Atmosphere: {h.mood}</p>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* زر التصدير العائم */}
                    <button 
                        onClick={() => window.print()} 
                        className="no-print fixed bottom-10 right-10 w-16 h-16 bg-fuchsia-600 text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-110 active:scale-90 transition-all z-50 group"
                        title="Export Pitch Deck"
                    >
                        <Lucide.Download size={24} />
                        <span className="absolute -top-12 scale-0 group-hover:scale-100 transition-all bg-black text-white text-[8px] px-3 py-1 rounded-full uppercase tracking-widest whitespace-nowrap">Export Pitch Deck</span>
                    </button>
                </div>
            );
        };

        createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
```
